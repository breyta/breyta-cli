## CLI distribution (releases + Homebrew)

This repo distributes the `breyta` CLI in two ways:

- **GitHub Releases** (prebuilt binaries for macOS/Linux/Windows)
- **Homebrew** (macOS via the `breyta/tap` tap)

Homebrew is a convenience installer/updater. It installs the same release artifacts we publish to GitHub Releases.

### How `brew tap breyta/tap` works

Homebrew taps are just Git repos that follow a naming convention:

- `brew tap <owner>/<tap>` clones `https://github.com/<owner>/homebrew-<tap>`

So `brew tap breyta/tap` clones:

- `https://github.com/breyta/homebrew-tap`

There is no central registry step required beyond the repo existing and being reachable.

### Repo prerequisites

- `breyta/breyta-cli` must be **public** (or at least its release assets must be publicly downloadable), otherwise Homebrew can’t download the tarballs.
- The tap repo must exist:
  - `breyta/homebrew-tap`
  - contains `Formula/breyta.rb` (generated by GoReleaser)

### Release pipeline (manual tags)

### Release checklist (local)

Before tagging:

```bash
# from breyta-cli/
make fmt test build
```

Run the CLI ↔ flows-api integration suite (recommended before every release). This assumes you have the “super-root” checkout with sibling directories `breyta/` and `breyta-cli/`:

```bash
# from breyta-cli/
make integration-test
```

If you want to start flows-api yourself and reuse it across runs:

```bash
IT_START_SERVER=false ../breyta/bases/flows-api/scripts/integration_tests.sh
```

Releases are cut by pushing a SemVer tag:

```bash
git tag v0.2.0
git push origin v0.2.0
```

This triggers GitHub Actions (`.github/workflows/release.yml`) which runs GoReleaser (`.goreleaser.yaml`) to:

- build binaries for:
  - macOS: `amd64`, `arm64`
  - Linux: `amd64`, `arm64`
  - Windows: `amd64`
- upload archives + `checksums.txt` to the GitHub Release
- update `breyta/homebrew-tap` by committing an updated `Formula/breyta.rb`

Build metadata is embedded via `-ldflags` and surfaced by:

```bash
breyta version
```

### Required GitHub secret

The release workflow uses `GORELEASER_GITHUB_TOKEN` to publish the release and to push to the tap repo.

In `breyta/breyta-cli` repo settings:

- Settings → Secrets and variables → Actions → Repository secrets
- Add `GORELEASER_GITHUB_TOKEN`

The token must have permission to:

- create/edit releases in `breyta/breyta-cli`
- push commits to `breyta/homebrew-tap`

### Verify a release (macOS)

After a tag:

```bash
brew tap breyta/tap
brew install breyta
breyta version
```

To force Homebrew to pick up a new release:

```bash
brew update
brew upgrade breyta
```
